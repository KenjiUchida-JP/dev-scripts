#!/usr/bin/env bash
# ==================================================
# Pre-commit Hook
# ã‚³ãƒŸãƒƒãƒˆå‰ã« build.sh ã‚’å®Ÿè¡Œã—ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åŒæœŸ
# ==================================================

set -e

# ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–å¾—
REPO_ROOT="$(git rev-parse --show-toplevel)"
BUILD_SCRIPT="${REPO_ROOT}/python/build.sh"

# build.sh ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
if [[ ! -f "$BUILD_SCRIPT" ]]; then
    echo "è­¦å‘Š: build.sh ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $BUILD_SCRIPT"
    exit 0
fi

# build.sh ã‚’å®Ÿè¡Œ
echo "ğŸ”§ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åŒæœŸä¸­..."
"$BUILD_SCRIPT"

# setup-project.sh ã«å¤‰æ›´ãŒã‚ã‚Œã°è‡ªå‹•ã§ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°
SETUP_SCRIPT="${REPO_ROOT}/python/setup-project.sh"
if [[ -f "$SETUP_SCRIPT" ]]; then
    if ! git diff --quiet "$SETUP_SCRIPT" 2>/dev/null; then
        echo "ğŸ“ setup-project.sh ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã«è¿½åŠ "
        git add "$SETUP_SCRIPT"
    fi
fi

echo "âœ… åŒæœŸå®Œäº†"
