#!/usr/bin/env bash
# ==================================================
# Pre-commit Hook
# Validates template system before commit
# ==================================================

set -e

# Get the repository root directory
REPO_ROOT="$(git rev-parse --show-toplevel)"

# List of build scripts to run
BUILD_SCRIPTS=(
    "${REPO_ROOT}/python/build.sh"
    "${REPO_ROOT}/nextjs/build.sh"
)

# Check if any templates or related files are being committed
CHANGED_FILES=$(git diff --cached --name-only)
if ! echo "$CHANGED_FILES" | grep -qE '^(templates/|python/|nextjs/|fullstack/|scripts/lib/)'; then
    # No template-related files changed, skip validation
    exit 0
fi

echo "üîç Validating template system..."

# Run all build scripts for validation
VALIDATION_FAILED=0
for BUILD_SCRIPT in "${BUILD_SCRIPTS[@]}"; do
    if [[ -f "$BUILD_SCRIPT" ]]; then
        echo "  Validating: $(basename $(dirname "$BUILD_SCRIPT"))"
        if ! "$BUILD_SCRIPT"; then
            VALIDATION_FAILED=1
        fi
    else
        echo "  ‚ö†Ô∏è  Warning: build.sh not found: $BUILD_SCRIPT"
    fi
done

if [[ $VALIDATION_FAILED -eq 1 ]]; then
    echo ""
    echo "‚ùå Template validation failed!"
    echo "   Please fix the errors above before committing."
    exit 1
fi

echo "‚úÖ Template validation passed"
