#!/usr/bin/env bash
# ==================================================
# Pre-commit Hook
# Runs build.sh to sync templates before commit
# ==================================================

set -e

# Get the repository root directory
REPO_ROOT="$(git rev-parse --show-toplevel)"
BUILD_SCRIPT="${REPO_ROOT}/python/build.sh"

# Check if build.sh exists
if [[ ! -f "$BUILD_SCRIPT" ]]; then
    echo "Warning: build.sh not found: $BUILD_SCRIPT"
    exit 0
fi

# Run build.sh
echo "ğŸ”§ Syncing templates..."
"$BUILD_SCRIPT"

# Auto-stage setup-project.sh if it has changes
SETUP_SCRIPT="${REPO_ROOT}/python/setup-project.sh"
if [[ -f "$SETUP_SCRIPT" ]]; then
    if ! git diff --quiet "$SETUP_SCRIPT" 2>/dev/null; then
        echo "ğŸ“ Adding setup-project.sh to staging"
        git add "$SETUP_SCRIPT"
    fi
fi

echo "âœ… Sync complete"
